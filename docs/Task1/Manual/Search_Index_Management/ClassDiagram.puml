@startuml search_subsystem

' Forces the layout to stack vertically
top to bottom direction
skinparam PackageStyle rectangle

package "org.apache.roller.weblogger.ui.struts2" {
    class SearchAction
    class SearchEntriesAction
}

package "org.apache.roller.weblogger.ui.rendering" {
    package "model" {
        class SearchResultsModel
        class SearchResultsFeedModel
    }
    package "pagers" {
        class SearchResultsPager
        class SearchResultsFeedPager
    }
}

package "org.apache.roller.weblogger.business.search" {
    interface IndexManager {
        + void initialize()
        + void addEntryIndexOperation(WeblogEntry)
        + SearchResultList search(String, String, ...)
    }

    class SearchResultList {
        - List<WeblogEntry> results
        - int hitCount
    }

    class SearchResultMap {
        - Map<String, List<WeblogEntry>> results
    }
}

package "org.apache.roller.weblogger.business.search.lucene" {
    class LuceneIndexManager {
        + void initialize()
        + void runOperation(IndexOperation)
    }

    class ReadonlyIndexManager

    abstract class IndexOperation {
        + void run()
    }

    class AddEntryOperation
    class ReIndexEntryOperation
    class RemoveEntryOperation
    class RebuildWebsiteIndexOperation
    class RemoveWebsiteIndexOperation

    class IndexUtil {
        + {static} Document entryToDocument(WeblogEntry)
    }

    class FieldConstants
    class IndexWriterPool
    class IndexSearcherPool
}

package "org.apache.roller.weblogger.business.search.operations" {
    class SearchOperation
}

package "org.apache.roller.weblogger.business.search.spi" {
    interface SearchPlugin
    interface SearchProvider
}

package "org.apache.roller.weblogger.pojos" {
    class WeblogEntrySearchCriteria
    class CommentSearchCriteria
    class SearchResult
}

package "org.apache.roller.weblogger.util" {
    class SearchRequestMatcher
    class SearchContext
}

' Relationships (Rearranged slightly to assist vertical flow)
LuceneIndexManager ..|> IndexManager
ReadonlyIndexManager ..|> IndexManager

IndexOperation <|-- AddEntryOperation
IndexOperation <|-- ReIndexEntryOperation
IndexOperation <|-- RemoveEntryOperation
IndexOperation <|-- RebuildWebsiteIndexOperation
IndexOperation <|-- RemoveWebsiteIndexOperation

LuceneIndexManager "1" *-- "0..*" IndexOperation

IndexManager ..> SearchResultList
IndexManager ..> SearchResultMap

SearchAction ..> IndexManager
SearchResultsModel ..> IndexManager
SearchResultsPager ..> SearchResult

IndexUtil ..> org.apache.roller.weblogger.pojos.WeblogEntry
SearchRequestMatcher ..> IndexManager

SearchProvider ..> IndexManager
IndexManager *-- SearchPlugin

@enduml
